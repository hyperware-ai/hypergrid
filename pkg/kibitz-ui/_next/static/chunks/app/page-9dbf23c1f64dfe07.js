(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4352:(e,t,r)=>{Promise.resolve().then(r.bind(r,9699))},9699:(e,t,r)=>{"use strict";r.d(t,{default:()=>e8});var n=r(5155),s=r(2115),a=r(8629),o=r(3463),l=r(9795);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,l.QP)((0,o.$)(t))}let c=a.bL,d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.B8,{ref:t,className:i("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s})});d.displayName=a.B8.displayName;let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.l9,{ref:t,className:i("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s})});u.displayName=a.l9.displayName;let m=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.UC,{ref:t,className:i("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s})});m.displayName=a.UC.displayName;var p=r(6710),h=r(2317),f=r(1027);let g=(0,f.F)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-primary/90 text-primary-foreground hover:bg-primary/60",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"},size:{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),x=s.forwardRef((e,t)=>{let{className:r,variant:s,size:a,asChild:o=!1,...l}=e,c=o?h.DX:"button";return(0,n.jsx)(c,{className:i(g({variant:s,size:a,className:r})),ref:t,...l})});x.displayName="Button";let v=()=>(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-[3px] border-current/30 border-t-current"});var y=r(3950);let j=()=>{let{projects:e,activeProjectId:t,createConversation:r,setActiveConversation:n,activeConversationId:a}=(0,y.Pj)(),o=e.find(e=>e.id===t),l=(0,s.useCallback)(t=>{let s=e.find(e=>e.id===t);if(!s)return;if(0===s.conversations.length){r(t);return}let a=s.conversations[s.conversations.length-1];if(0===a.messages.length){n(a.id);return}r(t)},[e,r,n]);return(0,s.useEffect)(()=>{if(t&&!a){let s=e.find(e=>e.id===t);if(s){if(0===s.conversations.length)r(t);else{let e=s.conversations[s.conversations.length-1];0===e.messages.length?n(e.id):r(t)}}}},[t,a,e,r,n]),{handleProjectFocus:l,activeProject:o}};var b=r(6217),w=r(767);let N=b.bL;b.l9;let k=b.ZL,A=s.forwardRef(function(e,t){return(0,n.jsx)(b.hJ,{ref:t,className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e})}),C=s.forwardRef(function(e,t){return(0,n.jsxs)(k,{children:[(0,n.jsx)(A,{}),(0,n.jsxs)(b.UC,{ref:t,className:i("fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg","max-w-[90%] sm:max-w-[85%] md:max-w-[80%] lg:max-w-[75%]","max-h-[85vh] overflow-y-auto",e.className),...e,children:[e.children,(0,n.jsxs)(b.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(w.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}),S=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:i("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})},R=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})},P=s.forwardRef(function(e,t){return(0,n.jsx)(b.hE,{ref:t,className:i("text-lg font-semibold leading-none tracking-tight",e.className),...e})});var _=r(314),E=r(4504);let I=e=>{let{toolCall:t,onClose:r}=e,[a,o]=(0,s.useState)(!1);return(0,n.jsx)(N,{open:!0,onOpenChange:r,children:(0,n.jsxs)(C,{children:[(0,n.jsx)(S,{className:"mb-4 shrink-0",children:(0,n.jsxs)("div",{className:"flex justify-between items-center gap-4",children:[(0,n.jsx)(P,{className:"truncate",children:"Tool Call: ".concat(t.name)}),(0,n.jsx)(x,{variant:"ghost",size:"icon",onClick:()=>o(!a),children:a?(0,n.jsx)(_.A,{className:"h-4 w-4"}):(0,n.jsx)(E.A,{className:"h-4 w-4"})})]})}),(0,n.jsxs)("div",{className:i("space-y-4 overflow-hidden flex-grow overflow-y-auto pr-2",a&&"h-[75vh]"),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"Input:"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("pre",{className:i("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!a&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:JSON.stringify(t.input,null,2)}),!a&&(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"Result:"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("pre",{className:i("bg-muted p-2 sm:p-4 rounded-md whitespace-pre-wrap break-all text-sm sm:text-base",!a&&"max-h-[100px] sm:max-h-[120px] overflow-hidden"),children:t.result||"No result available"}),!a&&(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-muted to-transparent pointer-events-none"})]})]})]})]})})};var T=r(5565),M=r(3550),O=r(6246),z=r(8867),D=r(7341);let F=e=>{let{text:t,className:r="",light:a=!1}=e,[o,l]=(0,s.useState)(!1),i=async e=>{e.preventDefault(),e.stopPropagation();try{await navigator.clipboard.writeText(t),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){console.error("Failed to copy text:",e)}};return(0,n.jsxs)("button",{onClick:i,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm ".concat(a?"text-accent-foreground hover:bg-accent-foreground/10":"hover:bg-kinode-orange/10"," ").concat(r),children:[o?(0,n.jsx)(z.A,{className:"h-4 w-4"}):(0,n.jsx)(D.A,{className:"h-4 w-4"}),o?"Copied":"Copy"]})},K=e=>{let{content:t,isUserMessage:r,onToolClick:s,toolResult:a,contentIndex:o,messageIndex:l}=e;return"text"===t.type?(0,n.jsx)("div",{className:"flex max-w-full pt-6",children:(0,n.jsxs)("div",{className:"relative group w-full max-w-full overflow-x-auto",children:[!t.text.match(/```[\s\S]*```/)&&(0,n.jsx)("div",{className:"absolute right-2 top-0 z-10",children:(0,n.jsx)(F,{text:t.text.trim(),light:r,className:"opacity-0 group-hover:opacity-100 transition-opacity"})}),(0,n.jsx)("div",{className:"w-full max-w-full rounded-lg px-4 py-2 ".concat(r?"bg-accent !text-accent-foreground":"bg-muted text-foreground"),children:(0,n.jsx)(M.o,{className:"prose dark:prose-invert break-words max-w-full inline-code-fix ".concat(r?"[&_p]:!text-accent-foreground [&_code]:!text-accent-foreground":""),components:{p:e=>{let{children:t}=e;return(0,n.jsx)("p",{className:"break-words whitespace-pre-wrap overflow-hidden",children:t})},pre(e){let{children:t,...s}=e,a=e=>{if("string"==typeof e)return e;if(!e)return"";if(Array.isArray(e))return e.map(a).join("\n");if("object"==typeof e&&null!==e&&"props"in e){var t,r,n;if((null===(r=e.props)||void 0===r?void 0:null===(t=r.className)||void 0===t?void 0:t.includes("language-"))||(null===(n=e.props)||void 0===n?void 0:n.children))return a(e.props.children)}return""},o=a(t).trim();return(0,n.jsxs)("div",{className:"group/code relative max-w-full",children:[(0,n.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,n.jsx)(F,{text:o,light:r,className:"opacity-0 group-hover/code:opacity-100 transition-opacity"})}),(0,n.jsx)("pre",{className:"overflow-x-auto max-w-full whitespace-pre",...s,children:t})]})},code(e){let{className:t,children:r}=e;return(null==t?void 0:t.includes("language-"))===!1?(0,n.jsx)("code",{className:"text-inherit inline-block align-baseline",children:r}):(0,n.jsx)("code",{className:"block overflow-x-auto whitespace-pre-wrap",children:r})},a:e=>{let{href:t,children:r}=e;return(0,n.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:r})}},remarkPlugins:[O.A],children:t.text})})]})},"text-".concat(l,"-").concat(o)):"image"===t.type?(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat(r?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,n.jsx)(T.default,{src:"data:".concat(t.source.media_type,";base64,").concat(t.source.data),alt:"User uploaded image",className:"max-h-[150px] max-w-[300px] w-auto h-auto rounded object-contain",width:300,height:150})})},"image-".concat(l,"-").concat(o)):"document"===t.type?(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"w-full rounded-lg px-4 py-2 ".concat(r?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,n.jsx)("embed",{src:"data:".concat(t.source.media_type,";base64,").concat(t.source.data),type:t.source.media_type,width:"100%",height:"600px",className:"rounded"})})},"document-".concat(l,"-").concat(o)):"tool_use"===t.type?(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"w-full rounded-lg px-4 py-2 relative group ".concat(r?"bg-accent text-accent-foreground":"bg-muted text-foreground"),children:(0,n.jsx)("div",{className:"space-y-2",children:(0,n.jsxs)("button",{onClick:()=>null==s?void 0:s(t.name,t.input,a),className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 underline group",children:["\uD83D\uDEE0️: ",t.name]})})})},"tool_use-".concat(l,"-").concat(o)):null},U=e=>{let{files:t,onRemove:r}=e;return 0===t.length?null:(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:t.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2 bg-muted rounded px-2 py-1",children:[(0,n.jsx)("span",{className:"text-sm",children:"text"===e.type?"Text file":"fileName"in e&&e.fileName||"Untitled"}),(0,n.jsx)("button",{onClick:()=>r(t),className:"hover:text-destructive",children:(0,n.jsx)(w.A,{className:"h-4 w-4"})})]},t))})},q=s.forwardRef((e,t)=>{let{className:r,maxRows:a=8,onChange:o,...l}=e,c=s.useRef(null),d=s.useCallback(e=>{e.style.height="auto";let t=a*parseInt(getComputedStyle(e).lineHeight||"16"),r=window.getComputedStyle(e).maxHeight,n="none"!==r&&"auto"!==r?parseInt(r,10):t,s=Math.min(e.scrollHeight+5,n);e.style.height="".concat(Math.max(s,40),"px"),e.scrollHeight>n?e.style.overflowY="auto":e.style.overflowY="hidden"},[a]),u=s.useCallback(e=>{c.current&&d(c.current),null==o||o(e)},[d,o]);return s.useEffect(()=>{if(c.current){c.current.style.height="2.5em",d(c.current);let e=new ResizeObserver(()=>{c.current&&d(c.current)});return e.observe(c.current),()=>{e.disconnect()}}},[d]),s.useEffect(()=>{c.current&&requestAnimationFrame(()=>{c.current&&(d(c.current),setTimeout(()=>{c.current&&d(c.current)},50))})},[l.value,d]),(0,n.jsx)("textarea",{className:i("flex min-h-[2.5em] w-full rounded-md border border-input bg-transparent px-3 py-2 text-[12px] ring-offset-background placeholder:text-muted-foreground placeholder:text-[12px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 overflow-y-hidden resize-none",r),ref:e=>{c.current=e,"function"==typeof t?t(e):t&&(t.current=e)},onChange:u,onInput:e=>{c.current&&d(c.current)},...l})});q.displayName="Textarea";var H=r(3608);let L=["image/jpeg","image/png","image/gif","image/webp"],B=["application/pdf"],G=["applications/javascript","application/typescript","application/x-httpd-php","application/x-sh","application/x-powershell","application/json","application/xml","application/yaml","application/toml","application/x-tex","application/sql","application/x-python","application/x-ruby","application/x-diff","application/x-patch","application/typescript","application/x-properties"],J=e=>{let{onFileSelect:t,onUploadComplete:r}=e,a=(0,s.useRef)(null),o=(0,s.useCallback)(async e=>{if(!(L.includes(e.type)||B.includes(e.type)||e.type.startsWith("text/")||G.includes(e.type))){alert("Unsupported file type. Please upload an image (JPEG, PNG, GIF, WebP), a PDF, or a plaintext document.");return}let n=new FileReader;n.onload=async()=>{let s=n.result.split(",")[1];if(e.type.startsWith("text/")||G.includes(e.type)){t({type:"text",text:function(e){try{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return new TextDecoder("utf-8").decode(r)}catch(e){throw Error("Failed to decode base64 string: "+e.message)}}(s)}),null==r||r();return}L.includes(e.type)?(t({type:"image",source:{type:"base64",media_type:e.type,data:s},fileName:e.name}),null==r||r()):"application/pdf"===e.type&&(t({type:"document",source:{type:"base64",media_type:"application/pdf",data:s},fileName:e.name}),null==r||r())},n.readAsDataURL(e)},[t,r]),l=(0,s.useCallback)(async e=>{for(let t of Array.from(e.target.files||[]))await o(t)},[o]),i=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),c=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&Array.from(e.dataTransfer.files).forEach(o)},[o]);return s.useEffect(()=>{let e=document.getElementById("chat-view"),t=document.querySelector(".flex.flex-col.h-full.relative")||document.body,r=e||t;return r.addEventListener("dragover",i),r.addEventListener("drop",c),()=>{r.removeEventListener("dragover",i),r.removeEventListener("drop",c)}},[i,c]),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:"file",ref:a,onChange:l,accept:[...L,...B,...G,"text/*"].join(","),className:"hidden",multiple:!0}),(0,n.jsx)(x,{onClick:()=>{var e;null===(e=a.current)||void 0===e||e.click()},variant:"ghost",size:"icon",className:"h-7 w-7",title:"Upload files (Images or PDFs)",children:(0,n.jsx)(H.A,{className:"h-4 w-4"})})]})};var V=r(6164);let Y=e=>{let{onTranscriptionComplete:t}=e,[r,a]=(0,s.useState)(!1),[o,l]=(0,s.useState)(!1),i=(0,s.useRef)(null),c=(0,s.useRef)([]),{projects:d,activeProjectId:u}=(0,y.Pj)(),m=d.find(e=>e.id===u),p=(0,s.useRef)(null),h=(0,s.useRef)(null),f=(0,s.useRef)(null),g=(0,s.useRef)(null),j=async e=>{e.preventDefault(),e.stopPropagation(),r?w():await b()},b=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new AudioContext,r=t.createAnalyser();t.createMediaStreamSource(e).connect(r),r.fftSize=128,r.smoothingTimeConstant=.8,f.current=r,g.current=t;let n=new MediaRecorder(e);i.current=n,c.current=[],n.ondataavailable=e=>{e.data.size>0&&c.current.push(e.data)},n.onstop=async()=>{let t=new Blob(c.current,{type:"audio/webm"});l(!0),await R(t),l(!1),e.getTracks().forEach(e=>e.stop())},n.start(),a(!0)}catch(e){console.error("Error accessing microphone:",e),alert("Error accessing microphone. Please ensure microphone permissions are granted.")}},w=()=>{i.current&&r&&(i.current.stop(),a(!1),g.current&&g.current.close(),h.current&&cancelAnimationFrame(h.current))},k=s.useCallback(()=>{if(!p.current)return;let e=p.current,t=window.devicePixelRatio||1,r=e.getBoundingClientRect();e.width=r.width*t,e.height=r.height*t;let n=e.getContext("2d");n&&n.scale(t,t)},[]),A=s.useCallback(()=>{if(!f.current||!p.current)return;let e=p.current,t=e.getContext("2d");if(!t)return;let n=e.getBoundingClientRect(),s=f.current.frequencyBinCount,a=new Uint8Array(s),o=[];for(let e=0;e<=255;e+=8){let t=e/255;o.push("rgba(59, 130, 246, ".concat(t,")"))}let l=0,i=()=>{var c;if(!r)return;let d=performance.now();if(d-l<33.333333333333336){h.current=requestAnimationFrame(i);return}l=d,null===(c=f.current)||void 0===c||c.getByteFrequencyData(a);let u=window.devicePixelRatio||1;t.clearRect(0,0,e.width,e.height);let m=n.width,p=n.height,g=m/32*.8,x=0;for(let e=0;e<32;e++){let r=Math.floor(e/32*(s/4)),n=a[r]/255*p,l=Math.floor(a[r]/255*(o.length-1));t.fillStyle=o[l],t.fillRect(x*u,(p-n)*u,g*u,n*u),x+=g+2}};i()},[r]);(0,s.useEffect)(()=>{let e;return r&&(k(),A(),e=new ResizeObserver(()=>{k()}),p.current&&e.observe(p.current),h.current=requestAnimationFrame(function e(){A(),r&&(h.current=requestAnimationFrame(e))})),()=>{h.current&&cancelAnimationFrame(h.current),e&&e.disconnect()}},[r,A,k]);let R=async e=>{if(!(null==m?void 0:m.settings.groqApiKey)){alert("Please set your GROQ API key in settings first");return}let r=new FormData;r.append("file",e,"recording.webm"),r.append("model","whisper-large-v3");try{let e=await fetch("https://api.groq.com/openai/v1/audio/transcriptions",{method:"POST",headers:{Authorization:"Bearer ".concat(m.settings.groqApiKey)},body:r});if(!e.ok)throw Error("Error transcribing audio: ".concat(e.statusText));let n=await e.json();n.text&&t(n.text)}catch(e){console.error("Error transcribing audio:",e),l(!1),alert("Error transcribing audio. Please check your GROQ API key and try again.")}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)(x,{variant:"ghost",size:"icon",className:"h-7 w-7 ".concat(r?"text-red-500":""," hover:bg-accent hover:text-accent-foreground"),onClick:j,disabled:!(null==m?void 0:m.settings.groqApiKey)||o,title:(null==m?void 0:m.settings.groqApiKey)?r?"Stop Recording":"Start Recording":"Set GROQ API key in settings to enable voice recording",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(V.A,{className:"h-4 w-4"}),o&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(v,{})})]})}),(0,n.jsx)(N,{open:r,onOpenChange:e=>{!e&&r&&w()},children:(0,n.jsxs)(C,{children:[(0,n.jsxs)(S,{className:"pb-2",children:[(0,n.jsx)(P,{className:"sr-only",children:"Voice Recording in Progress"}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Listening"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tap anywhere to transcribe"})]})]}),(0,n.jsx)("div",{className:"mt-2",onClick:w,children:(0,n.jsx)("canvas",{ref:p,className:"w-full h-24 sm:h-32 bg-background border rounded-md",style:{touchAction:"none"}})})]})})]})})};var W=r(98),Q=r(1406),Z=r(8283),X=r(6440),$=r(4521);async function ee(e,t,r,n){if(!r||!r.trim())throw Error("".concat(t," API key is required."));if(!e||!e.trim())throw Error("Original prompt cannot be empty.");if(!n||!n.trim())throw Error("Model name is required.");let s='SYSTEM INSTRUCTIONS TO MODEL\n\nYou are a Prompt Improvement Assistant.\nYour task is to refine a user\'s prompt to make it clearer, more detailed, and better structured, without changing the user\'s original intent.\n\nFollow these rules carefully:\n\n*   Structure the prompt with clear sections like "Core Features", "Visual References", and "Style Guide" when appropriate.\n*   Include specific design guidelines, colors, typography, and layout information when enhancing UI/design related prompts.\n*   When listing features, use bullet points for clear organization.\n*   Add visual references to well-known examples when it helps clarify the request.\n*   Never specify a programming language unless the user explicitly mentioned one.\n*   Keep the improved prompt professional and implementation-agnostic unless specific technologies were requested.\n*   Use numbered lists for sequential steps and bullet points for non-sequential items.\n*   Output ONLY the improved version of the prompt. Do not explain your edits.\n\nExamples:\n\nUser prompt: "write a button component"\nImproved prompt: "Create a reusable button component with the following features:\n- Primary, secondary, and disabled states\n- Customizable text and icon support\n- Responsive sizing (small, medium, large variants)\n- Hover and active states with appropriate transitions\n\nVisual References:\nInspired by Material Design buttons with clean, minimal styling\n\nStyle Guide:\n- Colors: Primary #3B82F6, Secondary #6B7280, Disabled #E5E7EB\n- Typography: 14px medium weight for default size\n- Padding: 8px 16px with 4px border radius\n- Transitions: 150ms ease-in-out for all state changes"\n\nUser prompt: "make tic tac toe game"\nImproved prompt: "A classic web-based Tic-Tac-Toe game where two players can compete against each other on a 3x3 grid.\n\nCore Features:\n- Interactive 3x3 game board\n- Alternating turns between X and O players\n- Win detection and game status display\n- Option to restart the game\n\nVisual References:\nInspired by Google\'s Tic-Tac-Toe game interface, known for its clean and minimalist design.\n\nStyle Guide:\n- Colors: Primary #007AFF (blue), Secondary #FF3B30 (red), Background #F2F2F7 (light grey), Text #1C1C1E (dark grey), Grid Lines #C7C7CC (medium grey)\n- Design: System fonts, centered board layout with clear grid lines, 24px spacing, responsive square grid, smooth transitions"\n\n---\n\nUser prompt:\n"{USER_PROMPT}"\n\nImproved prompt:'.replace("{USER_PROMPT}",e);try{var a,o,l;let e;if("openai"===t||"openrouter"===t){let l=new X.Ay({apiKey:r,baseURL:"openrouter"===t?"https://openrouter.ai/api/v1":void 0,dangerouslyAllowBrowser:!0}),i="openrouter"===t?{headers:{"HTTP-Referer":window.location.origin||"https://kibitz.app","X-Title":"Kibitz Prompt Enhancer",Authorization:"Bearer ".concat(r)}}:void 0;try{let t=await l.chat.completions.create({model:n,messages:[{role:"user",content:s}],temperature:.5,max_tokens:500,top_p:1,frequency_penalty:0,presence_penalty:0},i);e=null===(o=t.choices[0])||void 0===o?void 0:null===(a=o.message)||void 0===a?void 0:a.content}catch(e){throw console.error("OpenRouter/OpenAI API error:",e),e}}else if("anthropic"===t){let t=new $.NB({apiKey:r,dangerouslyAllowBrowser:!0}),a=await t.messages.create({model:n,max_tokens:500,messages:[{role:"user",content:s}],temperature:.5});e=(null===(l=a.content[0])||void 0===l?void 0:l.type)==="text"?a.content[0].text:null}if(!e)throw Error("API returned an empty or invalid response.");return e.trim().replace(/^"|"$/g,"")}catch(e){if(console.error("Error enhancing prompt with ".concat(t,":"),e),e instanceof Error)throw Error("Failed to enhance prompt using ".concat(t,": ").concat(e.message));throw Error("An unknown error occurred while enhancing the prompt using ".concat(t,"."))}}let et=e=>{let{value:t,onChange:r,onSend:a,onStop:o,isLoading:l,isDisabled:i,onFileSelect:c,placeholder:d="Type your message",provider:u,apiKey:m,model:p,showError:h}=e,f=(0,s.useRef)(null),[g,y]=(0,s.useState)(!1),[j,b]=(0,s.useState)(!1);s.useEffect(()=>{if(!f.current)return;let e=e=>{e.style.height="auto";let t=parseInt(window.getComputedStyle(e).maxHeight||"150px",10);e.style.height="".concat(Math.min(e.scrollHeight+5,t),"px"),e.style.overflowY=e.scrollHeight>t?"auto":"hidden"},t=()=>{f.current&&requestAnimationFrame(()=>{e(f.current)})},r=new MutationObserver(e=>{t()});return r.observe(f.current,{attributes:!0,childList:!1,subtree:!1,characterData:!0,attributeFilter:["value"]}),t(),()=>{r.disconnect()}},[]),s.useEffect(()=>{if(f.current){f.current.style.height="auto";let e=parseInt(window.getComputedStyle(f.current).maxHeight||"150px",10);f.current.style.height="".concat(Math.min(f.current.scrollHeight+5,e),"px"),f.current.style.overflowY=f.current.scrollHeight>e?"auto":"hidden"}},[t]);let w=async()=>{if(!u||!p){null==h||h("Cannot improve prompt. Provider or model configuration is missing. Please check settings.");return}if(!t.trim()){null==h||h("Cannot improve an empty prompt.");return}if(!m){null==h||h("Cannot improve prompt. API Key for the selected provider ('".concat(u,"') is missing. Please add it in Settings."));return}if("openai"!==u&&"anthropic"!==u&&"openrouter"!==u){null==h||h("Prompt improvement is not supported for the '".concat(u,"' provider yet."));return}y(!0);try{let e=await ee(t,u,m,p);r(e),setTimeout(()=>{if(f.current){f.current.style.height="auto";let e=parseInt(window.getComputedStyle(f.current).maxHeight||"150px",10);f.current.style.height=Math.min(f.current.scrollHeight+5,e)+"px",f.current.style.overflowY=f.current.scrollHeight>e?"auto":"hidden",console.log("Applied direct height:",f.current.style.height),setTimeout(()=>{f.current&&(f.current.style.height=Math.min(f.current.scrollHeight+5,e)+"px",f.current.style.overflowY=f.current.scrollHeight>e?"auto":"hidden",console.log("Applied secondary height:",f.current.style.height))},100)}},10),b(!0)}catch(e){console.error("Improve prompt error:",e),null==h||h(e instanceof Error?e.message:"An unknown error occurred while improving the prompt.")}finally{y(!1)}};return(0,n.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,n.jsxs)("div",{className:"relative flex-1",children:[(0,n.jsx)(q,{value:l?"Processing...":t,onChange:e=>{r(e.target.value)},placeholder:d,readOnly:l,onKeyDown:e=>{let t=window.matchMedia("(max-width: 768px)").matches;"Enter"!==e.key||e.shiftKey||l||t||(e.preventDefault(),a())},ref:f,className:"pr-20 transition-colors max-h-[150px] overflow-y-auto ".concat(l?"bg-muted text-muted-foreground resize-none":""),maxRows:8,disabled:i||l}),(0,n.jsxs)("div",{className:"absolute right-2 bottom-2 flex gap-1 items-center",children:[!j&&(0,n.jsx)(x,{variant:"ghost",size:"icon",onClick:w,disabled:l||g||!t.trim(),className:"w-8 h-8 p-1 text-muted-foreground hover:text-foreground",title:"Improve prompt",children:g?(0,n.jsx)(v,{}):(0,n.jsx)(W.A,{className:"w-4 h-4"})}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(J,{onFileSelect:c,onUploadComplete:()=>{f.current&&f.current.focus()}}),(0,n.jsx)(Y,{onTranscriptionComplete:e=>{r(t.trim()?"".concat(t,"\n").concat(e):e)}})]})]})]}),(0,n.jsx)(x,{onClick:l?o:a,disabled:i||l&&!o,className:"self-end relative ".concat(l?"bg-destructive hover:bg-destructive/90":""),children:l?(0,n.jsx)(Q.A,{className:"w-4 h-4"}):(0,n.jsx)(Z.A,{className:"w-4 h-4"})})]})};var er=r(1719);let en=e=>{let{onClick:t,visible:r}=e;return r?(0,n.jsx)("button",{onClick:t,className:"fixed bottom-[60px] right-2 md:right-8 z-[100] bg-primary/70 text-primary-foreground rounded-full p-3 shadow-lg hover:bg-primary/90 transition-all hover:scale-110 animate-in fade-in slide-in-from-right-2","aria-label":"Scroll to bottom",children:(0,n.jsx)(er.A,{className:"w-6 h-6"})}):null};class es{async acquire(){if(this.isSupported)try{this.wakeLock=await navigator.wakeLock.request("screen"),console.log("Screen wake lock acquired")}catch(e){console.warn("Failed to acquire wake lock:",e)}}async release(){if(this.wakeLock)try{await this.wakeLock.release(),this.wakeLock=null,console.log("Screen wake lock released")}catch(e){console.warn("Failed to release wake lock:",e)}}isActive(){return null!==this.wakeLock}constructor(){this.wakeLock=null,this.isSupported=!1,this.isSupported="undefined"!=typeof navigator&&"wakeLock"in navigator&&/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())}}let ea=new es;var eo=r(1491);let el="claude-sonnet-4-20250514",ei=()=>{let[e,t]=(0,s.useState)(!1),[r,n]=(0,s.useState)(null),a=(0,s.useRef)(!1),o=(0,s.useRef)(null),{projects:l,activeProjectId:i,activeConversationId:c,updateProjectSettings:d,renameConversation:u,servers:m,executeTool:p}=(0,y.Pj)(),h=l.find(e=>e.id===i),f=(0,s.useCallback)(e=>{var t;if(!(null==h?void 0:null===(t=h.settings.mcpServerIds)||void 0===t?void 0:t.length))return[];let r=new Map;m.filter(e=>h.settings.mcpServerIds.includes(e.id)).flatMap(e=>e.tools||[]).forEach(e=>{r.has(e.name)||r.set(e.name,{name:e.name,description:e.description||"Tool ".concat(e.name),input_schema:e.input_schema})});let n=Array.from(r.values());return e?n.map((e,t,r)=>t!=r.length-1?e:{...e,cache_control:{type:"ephemeral"}}):n},[null==h?void 0:h.settings.mcpServerIds,m]),g=(0,s.useCallback)((e,t,r)=>{let n=null==h?void 0:h.conversations.find(e=>e.id===t);n&&d(e,{conversations:h.conversations.map(e=>e.id===t?{...n,messages:r,lastUpdated:new Date}:e)})},[h,d]);return{isLoading:e,error:r,handleSendMessage:async(e,r)=>{var s,l,i,d,x,v,y,j,b;if(a.current=!1,!e.trim()&&0===r.length||!h||!c)return;n(null),t(!0);let w="openrouter"===h.settings.provider?h.settings.openRouterApiKey:h.settings.anthropicApiKey||h.settings.apiKey;if(!(null==w?void 0:w.trim())){n("API key not found. Please set your ".concat("openrouter"===h.settings.provider?"OpenRouter":"Anthropic"," API key in the Settings panel.")),t(!1);return}let N=e=>{if(e instanceof Error){try{var t;let r=JSON.parse(e.message);if((null===(t=r.error)||void 0===t?void 0:t.type)==="invalid_request_error"){if(r.error.message.includes("tokens > 200000"))return"Message is too long. Please reduce the length of your message or clear some conversation history.";return"API Error: ".concat(r.error.message)}}catch(e){}return e.message}return"An unknown error occurred"};await ea.acquire();try{let b=r.map(e=>(e.type,{...e,fileName:void 0}));e.trim()&&b.push({type:"text",text:e});let w=h.conversations.find(e=>e.id===c),k={role:"user",content:b,timestamp:new Date},A=[...(null==w?void 0:w.messages)||[],k];g(h.id,c,A);let C=new $.NB({apiKey:h.settings.anthropicApiKey||h.settings.apiKey||"",dangerouslyAllowBrowser:!0,maxRetries:12}),S=f(!0),R=f(!1),P=null===(s=h.settings.systemPrompt)||void 0===s?void 0:s.trim(),_=P?[{type:"text",text:P}]:void 0;console.log("Using provider:",h.settings.provider);let E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=t*Math.pow(2,e),n=1e3*Math.random();return Math.min(r+n,3e4)},I=async e=>{let t;for(let s=0;s<12;s++)try{return await C.messages.stream(e)}catch(e){if(t=e,console.log("got error ".concat(JSON.stringify(e))),"object"==typeof e&&null!==e){var r;if(((null===(r=e.error)||void 0===r?void 0:r.type)==="overloaded_error"||429===e.status)&&s<11){let e=E(s);console.log("Server overloaded. Retrying in ".concat(Math.round(e/1e3),"s (attempt ").concat(s+1,"/").concat(12,")")),n("Server overloaded. Retrying in ".concat(Math.round(e/1e3),"s (attempt ").concat(s+1,"/").concat(12,")")),await new Promise(t=>setTimeout(t,e));continue}}throw e}throw t};for(;!a.current;){let e=A.filter((e,t,r)=>{if("string"==typeof e.content)return!0;let n=e.content;if(!n.some(e=>"tool_use"===e.type))return!0;let s=r[t+1];if(!s||"string"==typeof s.content)return!1;let a=s.content;return n.every(e=>{if("tool_use"!==e.type||!("id"in e))return!0;let t=e.id;return a.some(e=>"tool_result"===e.type&&"tool_use_id"in e&&e.tool_use_id===t)})}).map((e,t,r)=>"anthropic"!==h.settings.provider||t<r.length-3?{role:e.role,content:e.content,toolInput:e.toolInput?e.toolInput:void 0}:{role:e.role,content:"string"==typeof e.content?[{type:"text",text:e.content,cache_control:{type:"ephemeral"}}]:e.content.map((e,t,r)=>t!=r.length-1?e:{...e,cache_control:{type:"ephemeral"}}),toolInput:e.toolInput?e.toolInput:void 0}).map(e=>({role:e.role,content:e.content,name:e.toolInput})),r={role:"assistant",content:[],timestamp:new Date},s={type:"text",text:""};if(r.content.push(s),"openai"===h.settings.provider||"openrouter"===h.settings.provider){let o="openrouter"===h.settings.provider?"https://openrouter.ai/api/v1":void 0,f="openrouter"===h.settings.provider?h.settings.openRouterApiKey:h.settings.openaiApiKey,b=new X.Ay({baseURL:o,apiKey:f,dangerouslyAllowBrowser:!0});try{let t=(0,eo.NQ)(e,R),n=await b.chat.completions.create({model:h.settings.model||"gpt-4",messages:t.messages,tools:t.tools,stream:!0}),o=null;for await(let e of n){if(a.current)break;let t=null==e?void 0:null===(d=e.choices)||void 0===d?void 0:null===(i=d[0])||void 0===i?void 0:null===(l=i.delta)||void 0===l?void 0:l.content,n=null==e?void 0:null===(y=e.choices)||void 0===y?void 0:null===(v=y[0])||void 0===v?void 0:null===(x=v.delta)||void 0===x?void 0:x.tool_calls;if(n){let e=n[0];if(o){if(e.function){let t=(null==o?void 0:o.name)||"",r=(null==o?void 0:o.arguments)||"";o={name:t||e.function.name||"",arguments:r+(e.function.arguments||"")}}}else e.function&&(o={name:e.function.name||"",arguments:e.function.arguments||""})}if(t){s.text+=t;let e=[...A,r];g(h.id,c,e)}}if(o){let e=o.name,t=JSON.parse(o.arguments||"{}"),n=m.find(t=>{var r;return null===(r=t.tools)||void 0===r?void 0:r.some(t=>(0,eo.nJ)(t.name)===e)}),s=null==n?void 0:null===(j=n.tools)||void 0===j?void 0:j.find(t=>(0,eo.nJ)(t.name)===e);if(!n||!s)throw Error("No server found for tool ".concat(e));let a={type:"tool_use",id:"tool_use_".concat(Date.now()),name:s.name,input:t};1==r.content.length&&"text"===r.content[0].type&&""===r.content[0].text?r.content=[a]:r.content.push(a),g(h.id,c,[...A,r]);let l=null==h?void 0:h.conversations.find(e=>e.id===c);if(l&&3===A.length&&"(New Chat)"===l.name){let e=A[0].content,t=A[1].content,r=await b.chat.completions.create({model:h.settings.model||"gpt-4",messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(e),"\nAssistant response: ").concat(Array.isArray(t)?t.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):t,"\n\nFormat: Only output the title, no quotes or explanation")}],max_tokens:20});if(r.choices[0].message.content){let e=r.choices[0].message.content.replace(/["']/g,"").replace(/title:?\s*/i,"").trim();e&&u(h.id,c,e)}}try{let e=await p(n.id,s.name,t),o={role:"user",content:[{type:"tool_result",tool_use_id:a.id,content:e}],timestamp:new Date};A.push(r),A.push(o),g(h.id,c,A)}catch(n){let e={role:"user",content:[{type:"tool_result",tool_use_id:a.id,content:"Error: ".concat(n instanceof Error?n.message:"Unknown error"),is_error:!0}],timestamp:new Date},t=[...A,r,e];g(h.id,c,t)}}else{A.push(r),g(h.id,c,A);let e=null==h?void 0:h.conversations.find(e=>e.id===c);if(e&&3===A.length&&"(New Chat)"===e.name){let e=A[0].content,t=A[1].content,r=await b.chat.completions.create({model:h.settings.model||"gpt-4",messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(e),"\nAssistant response: ").concat(Array.isArray(t)?t.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):t,"\n\nFormat: Only output the title, no quotes or explanation")}],max_tokens:20});if(r.choices[0].message.content){let e=r.choices[0].message.content.replace(/["']/g,"").replace(/title:?\s*/i,"").trim();e&&u(h.id,c,e)}}break}}catch(e){console.error("OpenAI API error:",e),n(N(e)),t(!1),ea.release();return}}else if("anthropic"===h.settings.provider){let t=(0,eo.HG)(e,P),n=await I({model:h.settings.model||el,max_tokens:8192,messages:t.messages,...t.system&&{system:t.system},..._&&_.length>0&&{system:_},...R.length>0&&{tools:S}});if(n.on("text",e=>{s.text+=e;let t=[...A,r];g(h.id,c,t)}),o.current=n,a.current)break;let l=await n.finalMessage(),i=l.content.map(e=>e.type&&"text"===e.type&&0===e.text.trim().length&&1===l.content.length?{...e,text:"empty"}:e).filter(e=>{if(!e.type||"text"!==e.type)return!0;let t=0===e.text.trim().length;return t&&1===l.content.length?(console.log("got unexpected whitespace case from assistant: ".concat(JSON.stringify(l))),e.text="empty",!0):!t}),d={...l,content:i};A.push(d),g(h.id,c,A);let f=null==h?void 0:h.conversations.find(e=>e.id===c);if(f&&2===A.length&&"(New Chat)"===f.name){let e=A[0].content,t=A[1].content,r=await C.messages.create({model:h.settings.model||el,max_tokens:20,messages:[{role:"user",content:"Generate a concise, specific title (3-4 words max) that accurately captures the main topic or purpose of this conversation. Use key technical terms when relevant. Avoid generic words like 'conversation', 'chat', or 'help'.\n\nUser message: ".concat(JSON.stringify(e),"\nAssistant response: ").concat(Array.isArray(t)?t.filter(e=>"text"===e.type).map(e=>"text"===e.type?e.text:"").join(" "):t,"\n\nFormat: Only output the title, no quotes or explanation")}]});if("text"===r.content[0].type){let e=r.content[0].text.replace(/["']/g,"").replace(/title:?\s*/i,"").trim();e&&u(h.id,c,e)}}let x=l.content.find(e=>"tool_use"===e.type);if(x&&"tool_use"===x.type)try{if(a.current)break;let e=m.find(e=>{var t;return null===(t=e.tools)||void 0===t?void 0:t.some(e=>e.name===x.name)});if(!e)throw Error("No server found for tool ".concat(x.name));let t=await p(e.id,x.name,x.input);if(a.current)break;let r={role:"user",content:[{type:"tool_result",tool_use_id:x.id,content:"string"==typeof t?t:JSON.stringify(t)}],timestamp:new Date};if(A.push(r),g(h.id,c,A),!a.current)continue;break}catch(t){let e={role:"user",content:[{type:"tool_result",tool_use_id:x.id,content:"Error: ".concat(t instanceof Error?t.message:"Unknown error"),is_error:!0}],timestamp:new Date};A.push(e),g(h.id,c,A)}if(!x)break}else{t(!1),ea.release();return}if(a.current)break}}catch(t){console.error("Failed to send message:",t);let e=N(t);t instanceof Error&&"Request was aborted."===t.message?console.log("Request was cancelled by user"):"object"==typeof t&&null!==t&&((null===(b=t.error)||void 0===b?void 0:b.type)==="overloaded_error"||429===t.status)?(console.error("Server overloaded, all retries failed:",t),a.current||n("Server is currently overloaded. Message sending failed after multiple retries. Please try again later.")):a.current||n(e)}finally{a.current=!1,t(!1),o.current=null,await ea.release()}},cancelCurrentCall:(0,s.useCallback)(()=>{a.current=!0,o.current&&o.current.abort(),t(!1),n("Operation cancelled")},[]),clearError:()=>{n(null)}}};var ec=r(8640),ed=r.n(ec);let eu=e=>{let{messages:t,scrollContainerRef:r}=e,n=(0,s.useRef)(null),a=r||n,[o,l]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{for(;!a.current;)await new Promise(e=>setTimeout(e,250));let e=a.current;0===e.scrollTop&&(e.scrollTop=e.scrollHeight);let t=ed()(()=>{let{scrollTop:t,scrollHeight:r,clientHeight:n}=e;l(e.scrollHeight<e.clientHeight||50>Math.abs(r-n-t))},100);return t(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)})()},[a]),(0,s.useEffect)(()=>{if(!a.current||!t.length)return;let e=t[t.length-1],r=t.length<=1;("assistant"===e.role||"user"===e.role)&&(o||r)&&requestAnimationFrame(()=>{let e=a.current;e&&(e.scrollTop=e.scrollHeight)})},[t,o,a]),{chatContainerRef:a,isAtBottom:o,scrollToBottom:()=>{let e=a.current;e&&(e.scrollTop=e.scrollHeight)}}},em=()=>{let[e,t]=(0,s.useState)(null);return{error:e,showError:e=>{t(e)},clearError:()=>{t(null)}}},ep=e=>{let{allMessages:t,initialPageSize:r=10,containerRef:n}=e,[a,o]=(0,s.useState)(r),[l,i]=(0,s.useState)(!1),c=(0,s.useRef)(null),d=(0,s.useRef)(null),u=n||d,m=(0,s.useRef)(!1),p=(0,s.useRef)(null),h=(0,s.useMemo)(()=>{if(0===t.length)return[];let e=Math.max(0,t.length-a);return t.slice(e)},[t,a]),f=a<t.length,g=(0,s.useCallback)(()=>{if(!f||l||m.current)return console.log("Skipping loadMoreMessages:",{hasMoreMessages:f,isLoadingMore:l,isAdjusting:m.current}),!1;let e=u.current;return e?(p.current={scrollHeight:e.scrollHeight,scrollTop:e.scrollTop,clientHeight:e.clientHeight},console.log("LOADING MORE MESSAGES. Current display count:",a,"Scroll position:",e.scrollTop),i(!0),o(e=>Math.min(t.length,e+5)),!0):(console.log("No container reference when trying to load more"),!1)},[f,l,t.length,a,u]),x=(0,s.useCallback)(e=>{if(m.current||l)return;let t=e.target;if(!t)return;let{scrollTop:r}=t;console.log("Scroll event captured, scrollTop:",r),r<=100&&f&&(console.log("TOP THRESHOLD REACHED! scrollTop:",r,"threshold:",100),g())},[f,l,g]);return(0,s.useEffect)(()=>{let e=u.current;if(!e){console.log("No scroll container available to attach listener to");return}console.log("Setting up scroll event listener on container:",e);let t=ed()(x,50);return e.addEventListener("scroll",t),setTimeout(()=>{if(e&&f&&!l){let{scrollTop:t}=e;t<100&&(console.log("Initial position near top, loading more"),g())}},300),()=>{console.log("Removing scroll listener from container"),e.removeEventListener("scroll",t)}},[u,x,f,l,g]),(0,s.useEffect)(()=>{l&&p.current&&u.current&&requestAnimationFrame(()=>{let e=u.current;if(!e)return;console.log("Adjusting scroll position after loading more messages");let t=e.scrollHeight,r=p.current.scrollHeight,n=t-r;console.log("Height difference:",n,"Old height:",r,"New height:",t),n>0?(m.current=!0,e.scrollTop=p.current.scrollTop+n,console.log("New scroll position after adjustment:",e.scrollTop),setTimeout(()=>{m.current=!1,i(!1),p.current=null},100)):(m.current=!1,i(!1),p.current=null)})},[l,h.length]),{visibleMessages:h,hasMoreMessages:f,isLoadingMore:l,loadMoreMessages:g,scrollContainerRef:u,anchorRef:c,displayCount:a}},eh=e=>{let{visible:t}=e;return t?(0,n.jsx)("div",{className:"flex justify-center py-2 opacity-90 transition-opacity duration-300",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-muted-foreground text-xs",children:[(0,n.jsx)("div",{className:"h-3 w-3",children:(0,n.jsx)(v,{})}),(0,n.jsx)("span",{children:"Loading older messages..."})]})}):null},ef=s.forwardRef((e,t)=>{var r,a,o,l;let[i,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(""),[m,p]=(0,s.useState)(null),{projects:h,activeProjectId:f,activeConversationId:g,updateProjectSettings:x}=(0,y.Pj)(),b=h.find(e=>e.id===f),w=null==b?void 0:b.conversations.find(e=>e.id===g),N=(null==b?void 0:b.settings.provider)==="openrouter"?null==b?void 0:b.settings.openRouterApiKey:(null==b?void 0:b.settings.provider)==="openai"?null==b?void 0:b.settings.openaiApiKey:(null==b?void 0:b.settings.anthropicApiKey)||(null==b?void 0:b.settings.apiKey),k=null==b?void 0:b.settings.provider,A=null==b?void 0:b.settings.model,C=(0,s.useMemo)(()=>(null==w?void 0:w.messages)?w.messages:[],[null==w?void 0:w.messages]),S=(0,s.useRef)(null),R=(0,s.useRef)(null);j();let{isLoading:P,error:_,handleSendMessage:E,cancelCurrentCall:T,clearError:M}=ei(),{error:O,showError:z,clearError:D}=em(),{visibleMessages:F,hasMoreMessages:q,isLoadingMore:H,loadMoreMessages:L,anchorRef:B,displayCount:G}=ep({allMessages:C,initialPageSize:15,containerRef:R}),{isAtBottom:J,scrollToBottom:V}=eu({messages:(null==w?void 0:w.messages)||[],scrollContainerRef:R});(0,s.useImperativeHandle)(t,()=>({focus:()=>{S.current&&S.current.focus()}}),[]),(0,s.useEffect)(()=>{R.current&&setTimeout(()=>{R.current&&(R.current.scrollTop=R.current.scrollHeight)},100)},[g]);let Y=(e,t)=>{let r=null==w?void 0:w.messages[e+1],n=null;if(r&&Array.isArray(r.content)){let e=r.content.find(e=>"tool_result"===e.type&&e.tool_use_id===t);e&&"tool_result"===e.type&&(n=e.content)}return n},W=(e,t)=>Array.isArray(e.content)?e.content.map((r,s)=>(0,n.jsx)(K,{content:r,isUserMessage:"user"===e.role,onToolClick:(e,t,r)=>{p({name:e,input:t,result:r})},toolResult:Array.isArray(e.content)&&"object"==typeof e.content[s]&&"type"in e.content[s]&&"tool_use"===e.content[s].type?Y(t,e.content[s].id):null,contentIndex:s,messageIndex:t},"".concat(r.type,"-").concat(t,"-").concat(s))):(0,n.jsx)(K,{content:{type:"text",text:e.content},isUserMessage:"user"===e.role,onToolClick:()=>{},toolResult:null,contentIndex:0,messageIndex:t},"string-".concat(t));if(!w)return(0,n.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,n.jsx)(v,{})});let Q=async()=>{try{await E(d,i),u(""),c([])}catch(e){z(e instanceof Error?e.message:"An error occurred")}};return(0,n.jsxs)("div",{id:"chat-view",className:"flex flex-col h-full relative",children:[(0,n.jsxs)("div",{ref:R,className:"h-[calc(100vh-4rem)] overflow-y-auto p-4",onScroll:e=>{let t=e.currentTarget;console.log("Scroll: top=".concat(t.scrollTop,", height=").concat(t.scrollHeight,", client=").concat(t.clientHeight))},children:[(0,n.jsx)(eh,{visible:H}),q&&!H&&(0,n.jsxs)("div",{className:"text-center my-2",children:[(0,n.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Showing ",G," of ",C.length," messages"]}),(0,n.jsx)("div",{className:"flex justify-center mt-1",children:(0,n.jsx)("button",{onClick:()=>{console.log("Manual load triggered"),q&&!H&&L()},className:"text-xs text-blue-500 hover:text-blue-700 underline",children:"Load older messages"})})]}),(0,n.jsx)("div",{className:"space-y-4 mb-4",children:F.map((e,t)=>{let r=0===t;return(0,n.jsx)("div",{ref:r?B:null,children:W(e,t)},"message-wrapper-".concat(t))})})]}),(0,n.jsx)(en,{onClick:V,visible:!J}),(O||_)&&(0,n.jsx)("div",{onClick:()=>{D(),M()},className:"fixed top-0 left-0 right-0 z-50 cursor-pointer md:top-4",children:(0,n.jsx)("div",{className:"mx-auto md:max-w-md md:mx-4",children:(0,n.jsx)("div",{className:"bg-destructive/15 dark:bg-destructive/25 border-b border-destructive/20 text-destructive dark:text-destructive-foreground px-4 py-3 md:rounded-lg shadow-lg backdrop-blur-sm",children:(0,n.jsxs)("div",{className:"flex items-center gap-3 max-w-full",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,n.jsx)("div",{className:"min-w-0 flex-1",children:(0,n.jsx)("p",{className:"text-sm font-medium leading-normal break-words",children:O||_})})]})})})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-background fixed bottom-0 left-0 right-0 z-50 md:left-[280px] md:w-[calc(100%-280px)]",children:[(0,n.jsx)(U,{files:i,onRemove:e=>{c(t=>t.filter((t,r)=>r!==e))}}),(0,n.jsx)(et,{value:d,onChange:u,onSend:Q,isLoading:P,onStop:T,isDisabled:!f||!g,onFileSelect:e=>{c(t=>[...t,{...e}])},placeholder:(null==b?void 0:null===(r=b.settings.apiKey)||void 0===r?void 0:r.trim())||(null==b?void 0:null===(a=b.settings.anthropicApiKey)||void 0===a?void 0:a.trim())||(null==b?void 0:null===(o=b.settings.openaiApiKey)||void 0===o?void 0:o.trim())||(null==b?void 0:null===(l=b.settings.openRouterApiKey)||void 0===l?void 0:l.trim())?P?"Processing response...":"Type your message":"⚠️ Set your API key in Settings to start chatting",provider:k,apiKey:N,model:A,showError:z})]}),m&&(0,n.jsx)(I,{toolCall:m,onClose:()=>p(null)})]})});ef.displayName="ChatView";let eg=s.memo(ef);var ex=r(9632),ev=r(8321),ey=r(6967),ej=r(3565);let eb=ev.bL,ew=ev.l9;ev.YJ,ev.ZL,ev.Pb,ev.z6,s.forwardRef((e,t)=>{let{className:r,inset:s,children:a,...o}=e;return(0,n.jsxs)(ev.ZP,{ref:t,className:i("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",r),...o,children:[a,(0,n.jsx)(ey.A,{className:"ml-auto h-4 w-4"})]})}).displayName=ev.ZP.displayName,s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(ev.G5,{ref:t,className:i("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",r),...s})}).displayName=ev.G5.displayName;let eN=s.forwardRef((e,t)=>{let{className:r,sideOffset:s=4,...a}=e;return(0,n.jsx)(ev.ZL,{children:(0,n.jsx)(ev.UC,{ref:t,sideOffset:s,className:i("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...a})})});eN.displayName=ev.UC.displayName;let ek=s.forwardRef((e,t)=>{let{className:r,inset:s,...a}=e;return(0,n.jsx)(ev.q7,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",r),...a})});ek.displayName=ev.q7.displayName,s.forwardRef((e,t)=>{let{className:r,children:s,checked:a,...o}=e;return(0,n.jsxs)(ev.H_,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:a,...o,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(ev.VF,{children:(0,n.jsx)(z.A,{className:"h-4 w-4"})})}),s]})}).displayName=ev.H_.displayName,s.forwardRef((e,t)=>{let{className:r,children:s,...a}=e;return(0,n.jsxs)(ev.hN,{ref:t,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...a,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(ev.VF,{children:(0,n.jsx)(ej.A,{className:"h-2 w-2 fill-current"})})}),s]})}).displayName=ev.hN.displayName,s.forwardRef((e,t)=>{let{className:r,inset:s,...a}=e;return(0,n.jsx)(ev.JU,{ref:t,className:i("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",r),...a})}).displayName=ev.JU.displayName,s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(ev.wv,{ref:t,className:i("-mx-1 my-1 h-px bg-muted",r),...s})}).displayName=ev.wv.displayName;var eA=r(5686),eC=r(7780);let eS=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:i("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});eS.displayName="Card";let eR=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:i("flex flex-col space-y-1.5 p-6",r),...s})});eR.displayName="CardHeader";let eP=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h3",{ref:t,className:i("text-lg font-semibold leading-none tracking-tight",r),...s})});eP.displayName="CardTitle";let e_=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("p",{ref:t,className:i("text-sm text-muted-foreground",r),...s})});e_.displayName="CardDescription";let eE=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:i("p-6 pt-0",r),...s})});eE.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:i(" flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter";let eI=s.forwardRef((e,t)=>{let{className:r,type:s,...a}=e;return(0,n.jsx)("input",{type:s,className:i("flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-[16px] ring-offset-background file:border-0 file:bg-transparent file:text-[16px] file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});eI.displayName="Input";var eT=r(3572);let eM=eT.bL;eT.l9;let eO=eT.ZL,ez=s.forwardRef(function(e,t){return(0,n.jsx)(eT.hJ,{className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e.className),...e,ref:t})}),eD=s.forwardRef(function(e,t){return(0,n.jsxs)(eO,{children:[(0,n.jsx)(ez,{}),(0,n.jsx)(eT.UC,{ref:t,className:i("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e.className),...e})]})}),eF=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:i("flex flex-col space-y-2 text-center sm:text-left",t),...r})},eK=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})},eU=s.forwardRef(function(e,t){return(0,n.jsx)(eT.hE,{ref:t,className:i("text-lg font-semibold",e.className),...e})}),eq=s.forwardRef(function(e,t){return(0,n.jsx)(eT.VY,{ref:t,className:i("text-sm text-muted-foreground",e.className),...e})}),eH=s.forwardRef(function(e,t){return(0,n.jsx)(eT.rc,{ref:t,className:i(g(),e.className),autoFocus:e.autoFocus,...e})}),eL=s.forwardRef(function(e,t){return(0,n.jsx)(eT.ZD,{ref:t,className:i(g({variant:"outline"}),"mt-2 sm:mt-0",e.className),...e})});var eB=r(6714);let eG=(0,f.F)("relative w-full rounded-lg border p-4 [&>svg]:absolute [&>svg]:text-foreground [&>svg]:left-4 [&>svg]:top-4 [&>svg+div]:translate-y-[-3px] [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive border-destructive/50 dark:border-destructive [&>svg]:text-destructive text-destructive"}},defaultVariants:{variant:"default"}}),eJ=s.forwardRef((e,t)=>{let{className:r,variant:s,...a}=e;return(0,n.jsx)("div",{ref:t,role:"alert",className:i(eG({variant:s}),r),...a})});eJ.displayName="Alert",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h5",{ref:t,className:i("mb-1 font-medium leading-none tracking-tight",r),...s})}).displayName="AlertTitle";let eV=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:i("text-sm [&_p]:leading-relaxed",r),...s})});eV.displayName="AlertDescription",r(1773);let eY=e=>{let{serverIds:t=[],onServerIdsChange:r}=e,[a,o]=(0,s.useState)({name:"",uri:""}),{addServer:l,removeServer:i,reconnectServer:c,servers:d}=(0,y.Pj)(),u=e=>{switch(e){case"connected":return"text-green-500";case"connecting":return"text-yellow-500";case"error":return"text-red-500";default:return"text-gray-500"}};return(0,n.jsx)(eS,{children:(0,n.jsxs)(eE,{className:"p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Hypergrid (Single MCP)"}),(0,n.jsx)("div",{className:"space-y-3 mb-4",children:Array.isArray(t)&&t.map(e=>{let t=d.find(t=>t.id===e);return t?(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"font-medium",children:t.name}),(0,n.jsxs)("span",{className:"text-sm ".concat(u(t.status)),children:["(",t.status,")"]})]}),(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:t.uri}),t.error&&(0,n.jsx)("div",{className:"text-sm text-red-500 mt-1",children:t.error})]}),!1]},t.id):null})}),!1,(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)(eJ,{children:(0,n.jsx)(eV,{children:"Hypergrid is preconfigured as the only MCP in this build."})})})]})})};var eW=r(994);let eQ=()=>{let{servers:e}=(0,y.Pj)(),[t,r]=(0,s.useState)({});return(0,n.jsxs)("div",{className:"space-y-4 p-4",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Available Tools"}),0===e.length?(0,n.jsx)(eJ,{children:(0,n.jsx)(eV,{children:"No MCP servers connected. Tools will appear here when servers connect."})}):e.map(e=>(0,n.jsxs)(eS,{className:"mb-4",children:[(0,n.jsxs)(eR,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eW.A,{className:"h-5 w-5 ".concat("connected"===e.status?"text-green-500":"connecting"===e.status?"text-yellow-500":"text-red-500")}),(0,n.jsx)(eP,{children:e.name})]}),(0,n.jsxs)(e_,{children:[e.uri," - ",e.status,e.error&&(0,n.jsxs)("span",{className:"text-red-500",children:[" (",e.error,")"]})]})]}),(0,n.jsx)(eE,{children:e.tools&&0!==e.tools.length?(0,n.jsx)("div",{className:"space-y-4",children:e.tools.map(e=>(0,n.jsxs)("div",{className:"border rounded-lg",children:[(0,n.jsx)("button",{onClick:()=>{r(t=>({...t,[e.name]:!t[e.name]}))},className:"w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(ey.A,{className:"h-4 w-4 transition-transform ".concat(t[e.name]?"transform rotate-90":"")}),(0,n.jsx)("h3",{className:"font-semibold",children:e.name})]})}),t[e.name]&&(0,n.jsxs)("div",{className:"px-4 pb-4",children:[(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),e.input_schema&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("h4",{className:"text-sm font-medium mb-1",children:"Input Schema:"}),(0,n.jsx)("pre",{className:"text-xs bg-muted p-2 rounded overflow-x-auto",children:JSON.stringify(e.input_schema,null,2)})]})]})]},e.name))}):(0,n.jsx)("p",{className:"text-muted-foreground",children:"No tools available from this server"})})]},e.id))]})};var eZ=r(7725),eX=r(2104),e$=r(7113);function e0(){let{setTheme:e}=(0,e$.D)();return(0,n.jsxs)(eb,{children:[(0,n.jsx)(ew,{asChild:!0,children:(0,n.jsxs)(x,{variant:"outline",size:"icon",className:"h-10 w-10 rounded-full shadow-lg bg-background/80 backdrop-blur-sm hover:bg-background/90",children:[(0,n.jsx)(eZ.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,n.jsx)(eX.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,n.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,n.jsxs)(eN,{align:"end",children:[(0,n.jsx)(ek,{onClick:()=>e("light"),children:"Light"}),(0,n.jsx)(ek,{onClick:()=>e("dark"),children:"Dark"}),(0,n.jsx)(ek,{onClick:()=>e("system"),children:"System"})]})]})}let e1=()=>{var e,t,r,a,o,l;let{projects:i,activeProjectId:m,updateProjectSettings:p,servers:h}=(0,y.Pj)(),[f,g]=(0,s.useState)(!1),[v,j]=(0,s.useState)("config"),[b,w]=(0,s.useState)(!1),[k,A]=(0,s.useState)(""),_=i.find(e=>e.id===m);if((0,s.useEffect)(()=>{if(!_)return;let e=_.settings.mcpServerIds||[],t=h.filter(e=>"connected"===e.status).map(e=>e.id);e.every(e=>t.includes(e))&&t.every(t=>e.includes(t))||E({mcpServerIds:t})},[m,h]),!_)return(0,n.jsx)("div",{className:"text-center text-muted-foreground",children:"Select a project to configure settings"});let E=e=>{console.log("handleSettingsChange - settings received:",e),void 0!==e.provider&&e.provider!==_.settings.provider?p(_.id,{settings:{..._.settings,...e,anthropicApiKey:_.settings.anthropicApiKey||_.settings.apiKey,openRouterApiKey:_.settings.openRouterApiKey||"",apiKey:"anthropic"===e.provider&&_.settings.anthropicApiKey||_.settings.apiKey,model:(0,y.pi)(e.provider)}}):p(_.id,{settings:{..._.settings,...e}})};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"fixed right-4 bottom-4 z-50",children:(0,n.jsx)(e0,{})}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)(c,{value:v,onValueChange:j,children:(0,n.jsxs)(d,{children:[(0,n.jsx)(u,{value:"config",children:"Configuration"}),(0,n.jsx)(u,{value:"tools",children:"Tools"})]})})}),"tools"===v?(0,n.jsx)(eQ,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eS,{children:(0,n.jsxs)(eE,{className:"p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"API Settings"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Provider"}),(0,n.jsxs)("select",{value:null!==(a=_.settings.provider)&&void 0!==a?a:"anthropic",onChange:e=>E({provider:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,n.jsx)("option",{value:"anthropic",children:"Anthropic (Claude)"}),(0,n.jsx)("option",{value:"openrouter",children:"OpenRouter"}),(0,n.jsx)("option",{value:"openai",children:"OpenAI"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["API Key ",(0,n.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required to chat. Get yours at"," ",(()=>{switch(_.settings.provider){case"openrouter":return(0,n.jsx)("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"openrouter.ai"});case"openai":return(0,n.jsx)("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"platform.openai.com"});default:return(0,n.jsx)("a",{href:"https://console.anthropic.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.anthropic.com"})}})()]}),(0,n.jsx)(eI,{type:"password",value:"openrouter"===_.settings.provider?_.settings.openRouterApiKey||"":"openai"===_.settings.provider?_.settings.openaiApiKey||"":_.settings.anthropicApiKey||_.settings.apiKey||"",onChange:e=>{let t=e.target.value.trim();switch(_.settings.provider){case"openrouter":E({openRouterApiKey:t});break;case"openai":E({openaiApiKey:t});break;default:E({anthropicApiKey:t,apiKey:t})}},placeholder:"openai"===_.settings.provider?"⚠️ Enter your OpenAI API key to use the chat":"openrouter"===_.settings.provider?"⚠️ Enter your OpenRouter API key to use the chat":"⚠️ Enter your Anthropic API key to use the chat",className:"openrouter"===_.settings.provider?"":(null===(e=_.settings.anthropicApiKey)||void 0===e?void 0:e.trim())||(null===(t=_.settings.apiKey)||void 0===t?void 0:t.trim())?"":"border-red-500 dark:border-red-400 placeholder:text-red-500/90 dark:placeholder:text-red-400/90 placeholder:font-medium"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"GROQ API Key"}),(0,n.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Required for voice transcription. Get yours at"," ",(0,n.jsx)("a",{href:"https://console.groq.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"console.groq.com"})]}),(0,n.jsx)(eI,{type:"password",value:_.settings.groqApiKey||"",onChange:e=>{E({groqApiKey:e.target.value.trim()})},placeholder:"Enter your GROQ API key for voice transcription"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Model"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("select",{value:"__CUSTOM__"!==_.settings.model&&(0,eB.SM)(_.settings.provider||"anthropic").includes(_.settings.model||"")?_.settings.model:"custom",onChange:e=>{console.log("Model dropdown onChange event:",e.target.value),"custom"===e.target.value?E({model:"__CUSTOM__"}):E({model:e.target.value})},className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,eB.SM)(_.settings.provider||"anthropic").map(e=>(0,n.jsx)("option",{value:e,children:e},e)),(0,n.jsx)("option",{value:"custom",children:"Custom"})]}),("__CUSTOM__"===_.settings.model||!(0,eB.SM)(_.settings.provider||"anthropic").includes(_.settings.model||""))&&(0,n.jsx)(eI,{value:"__CUSTOM__"===_.settings.model?"":_.settings.model||"",onChange:e=>{E({model:e.target.value||"__CUSTOM__"})},placeholder:"Enter custom model name",className:"w-full"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,n.jsx)("label",{className:"block text-sm font-medium",children:"System Prompt"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(null===(r=_.settings.savedPrompts)||void 0===r?void 0:r.length)?(0,n.jsxs)(eb,{children:[(0,n.jsx)(ew,{asChild:!0,children:(0,n.jsxs)(x,{variant:"outline",size:"sm",children:["Load Prompt ",(0,n.jsx)(er.A,{className:"ml-2 h-4 w-4"})]})}),(0,n.jsx)(eN,{children:_.settings.savedPrompts.map(e=>(0,n.jsxs)(ek,{className:"flex justify-between items-center",children:[(0,n.jsx)("div",{onClick:()=>E({systemPrompt:e.content}),className:"flex-grow cursor-pointer",children:e.name}),(0,n.jsx)(x,{variant:"ghost",size:"icon",className:"h-4 w-4 ml-2 hover:text-destructive",onClick:t=>{var r;t.stopPropagation(),E({savedPrompts:(null===(r=_.settings.savedPrompts)||void 0===r?void 0:r.filter(t=>t.id!==e.id))||[]})},children:(0,n.jsx)(eA.A,{className:"h-3 w-3"})})]},e.id))})]}):null,(0,n.jsxs)(x,{variant:"outline",size:"sm",onClick:()=>{A(""),w(!0)},children:[(0,n.jsx)(eC.A,{className:"mr-2 h-4 w-4"}),"Save Prompt"]})]})]}),(0,n.jsx)(q,{value:_.settings.systemPrompt,onChange:e=>E({systemPrompt:e.target.value}),placeholder:"Enter a system prompt...",className:"min-h-[100px]"})]}),(0,n.jsx)(N,{open:b,onOpenChange:w,children:(0,n.jsx)(C,{children:(0,n.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),k.trim()){let e={id:crypto.randomUUID(),name:k.trim(),content:_.settings.systemPrompt,createdAt:new Date};E({savedPrompts:[..._.settings.savedPrompts||[],e]}),w(!1)}},children:[(0,n.jsx)(S,{children:(0,n.jsx)(P,{children:"Save System Prompt"})}),(0,n.jsxs)("div",{className:"py-4",children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Name your prompt"}),(0,n.jsx)(eI,{value:k,onChange:e=>A(e.target.value),placeholder:"Enter a name for this prompt",autoFocus:!0})]}),(0,n.jsxs)(R,{children:[(0,n.jsx)(x,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),(0,n.jsx)(x,{type:"submit",children:"Save"})]})]})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Message Window Size"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Number of messages to show when History is disabled"}),(0,n.jsx)(eI,{type:"number",value:null!==(o=_.settings.messageWindowSize)&&void 0!==o?o:30,onChange:e=>{let t=parseInt(e.target.value);!isNaN(t)&&t>0&&E({messageWindowSize:t})},min:"1",className:"w-32"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"checkbox",id:"elideToolResults",checked:null!==(l=_.settings.elideToolResults)&&void 0!==l&&l,onChange:e=>E({elideToolResults:e.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,n.jsx)("label",{htmlFor:"elideToolResults",className:"text-sm font-medium",children:"Use Claude to elide tool results from previous messages"})]})]})]})}),(0,n.jsx)(eY,{serverIds:_.settings.mcpServerIds||[],onServerIdsChange:e=>E({mcpServerIds:e})}),(0,n.jsx)(eS,{className:"mt-6",children:(0,n.jsxs)(eE,{className:"p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Advanced Settings"}),(0,n.jsxs)("div",{className:"text-xs text-muted-foreground mb-4",children:["Database Version: ",ex.G8]}),(0,n.jsx)(x,{variant:"destructive",onClick:()=>g(!0),children:"Reset state"}),(0,n.jsx)(eM,{open:f,onOpenChange:g,children:(0,n.jsxs)(eD,{children:[(0,n.jsxs)(eF,{children:[(0,n.jsx)(eU,{children:"Reset Application State"}),(0,n.jsx)(eq,{children:"Are you sure you want to reset the application state? This will delete all projects, conversations, and settings. This action cannot be undone."})]}),(0,n.jsxs)(eK,{children:[(0,n.jsx)(eL,{children:"Cancel"}),(0,n.jsx)(eH,{onClick:async()=>{let e=async()=>Promise.all((await window.indexedDB.databases()).map(e=>new Promise((t,r)=>{let n=window.indexedDB.deleteDatabase(e.name);n.onsuccess=()=>t(),n.onerror=()=>r(n.error)})));try{await e(),window.location.reload()}catch(e){console.error("Error clearing databases:",e)}},children:"Reset"})]})]})})]})})]})]})};var e4=r(4024),e2=r(4857),e5=r(2060),e3=r(872);let e6=e=>{let{onExportConversation:t,isMobileMenuOpen:r=!0,onMobileMenuToggle:a,onConversationSelect:o}=e,{projects:l,activeProjectId:i,activeConversationId:c,createProject:d,deleteProject:u,createConversation:m,deleteConversation:h,renameConversation:f,renameProject:g,setActiveProject:v,setActiveConversation:j}=(0,y.Pj)(),[b,w]=(0,s.useState)(new Set),[k,A]=(0,s.useState)(!1);(0,s.useEffect)(()=>{i&&w(e=>{let t=new Set(e);return t.add(i),t})},[i]);let[_,E]=(0,s.useState)(!1),[I,T]=(0,s.useState)(null),[M,O]=(0,s.useState)(null),[z,D]=(0,s.useState)(""),F=e=>{w(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[K]=(0,s.useState)({}),U=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=l.find(t=>t.id===e);if(null==r?void 0:r.conversations){if(t&&0===r.conversations.length)m(e);else if(r.conversations.length>0){let t=K[e];t&&r.conversations.some(e=>e.id===t)?j(t):j(r.conversations[0].id)}v(e)}};(0,s.useEffect)(()=>{i&&c&&(K[i]=c)},[i,c]);let q=[...l].sort((e,t)=>(e.order||0)-(t.order||0));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x,{variant:"secondary",size:"icon",className:"fixed left-4 top-4 z-[100] md:hidden rounded-full shadow-lg hover:shadow-xl bg-background",onClick:a,"aria-label":"Toggle mobile menu",children:(0,n.jsx)(p.A,{className:"h-5 w-5"})}),(0,n.jsxs)("div",{className:"\n        fixed inset-y-0 left-0\n        md:sticky md:top-0 md:left-auto\n        w-[280px] max-w-[85vw]\n        bg-background border-r\n        transition-transform duration-200 ease-in-out\n        ".concat(r?"translate-x-0":"-translate-x-full","\n        md:translate-x-0\n        z-40\n        flex flex-col\n        h-screen\n      "),children:[(0,n.jsxs)("div",{className:"flex gap-2 mb-2 p-4 pt-16 md:pt-4",children:[(0,n.jsxs)(x,{onClick:()=>{d("New Project")},className:"flex-1",variant:"outline",children:[(0,n.jsx)(e4.A,{className:"w-4 h-4 mr-2"}),"New Project"]}),(0,n.jsx)(x,{onClick:()=>i&&t(i),variant:"outline",disabled:!i,children:(0,n.jsx)(e2.A,{className:"w-4 h-4"})})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0 px-4",children:q.map((e,t)=>(0,n.jsxs)("div",{className:"mb-2 ".concat(t>0?"mt-2 pt-2 border-t border-accent/35":""),children:[(0,n.jsxs)("div",{className:"p-2 rounded-lg flex items-center gap-2 transition-colors cursor-pointer\n                ".concat(e.id===i?"bg-accent text-accent-foreground":"hover:bg-muted","\n                text-sm font-medium"),onClick:t=>{t.stopPropagation(),F(e.id),e.id!==i&&(U(e.id,!0),null==a||a())},children:[(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),t.preventDefault(),F(e.id)},className:"p-1 hover:bg-muted-foreground/10 rounded",children:b.has(e.id)?(0,n.jsx)(er.A,{className:"w-4 h-4"}):(0,n.jsx)(ey.A,{className:"w-4 h-4"})}),(0,n.jsx)("span",{className:"truncate flex-1",title:e.name,children:e.name}),(0,n.jsx)(x,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),v(e.id),m(e.id),w(t=>{let r=new Set(t);return r.add(e.id),r}),null==o||o(),null==a||a()},title:"New chat",children:(0,n.jsx)(e5.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,n.jsx)(x,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),O({type:"project",projectId:e.id,currentName:e.name}),D(e.name),E(!0)},children:(0,n.jsx)(e3.A,{className:"w-4 h-4 opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})}),(0,n.jsx)(x,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:t=>{t.stopPropagation(),T({type:"project",projectId:e.id}),A(!0)},children:(0,n.jsx)(eA.A,{className:"w-4 h-4 text-destructive opacity-100 transition-all duration-200 hover:scale-125 hover:opacity-75"})})]}),b.has(e.id)&&(0,n.jsx)("div",{className:"ml-4 mt-1 space-y-1",children:e.conversations.sort((e,t)=>{let r=e=>e?e instanceof Date?e.getTime():new Date(e).getTime():Date.now(),n=r(e.createdAt||e.lastUpdated);return r(t.createdAt||t.lastUpdated)-n}).map(t=>(0,n.jsxs)("div",{className:"p-2 rounded-lg cursor-pointer flex items-center gap-2 transition-colors\n                      ".concat(t.id===c?"bg-accent text-accent-foreground":"hover:bg-muted","\n                      text-xs truncate max-w-[250px]"),onClick:()=>{U(e.id),j(t.id),null==o||o(),null==a||a()},children:[(0,n.jsx)("span",{className:"truncate flex-1",title:t.name,children:t.name}),(0,n.jsx)(x,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:r=>{r.stopPropagation(),O({type:"conversation",projectId:e.id,conversationId:t.id,currentName:t.name}),D(t.name),E(!0)},children:(0,n.jsx)(e3.A,{className:"w-4 h-4 opacity-100 transition-opacity duration-200 hover:opacity-75"})}),(0,n.jsx)(x,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6",onClick:r=>{r.stopPropagation(),T({type:"conversation",projectId:e.id,conversationId:t.id}),A(!0)},children:(0,n.jsx)(eA.A,{className:"w-4 h-4 text-destructive opacity-100 transition-opacity duration-200 hover:opacity-75"})})]},t.id))})]},e.id))}),(0,n.jsx)(eM,{open:k,onOpenChange:A,children:(0,n.jsxs)(eD,{children:[(0,n.jsxs)(eF,{children:[(0,n.jsxs)(eU,{children:["Delete ",(null==I?void 0:I.type)==="project"?"Project":"Conversation"]}),(0,n.jsxs)(eq,{children:["Are you sure you want to delete this ",null==I?void 0:I.type,"? This action cannot be undone.",(null==I?void 0:I.type)==="project"&&" All conversations in this project will be deleted."]})]}),(0,n.jsxs)(eK,{children:[(0,n.jsx)(eL,{onClick:()=>A(!1),children:"Cancel"}),(0,n.jsx)(eH,{onClick:()=>{I&&("project"===I.type?u(I.projectId):I.conversationId&&h(I.projectId,I.conversationId),A(!1),T(null))},autoFocus:!0,children:"Delete"})]})]})}),(0,n.jsx)(N,{open:_,onOpenChange:E,children:(0,n.jsx)(C,{children:(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),M&&z.trim()&&("project"===M.type?g(M.projectId,z.trim()):M.conversationId&&f(M.projectId,M.conversationId,z.trim()),E(!1),O(null),D(""))},children:[(0,n.jsx)(S,{children:(0,n.jsxs)(P,{children:["Rename ",(null==M?void 0:M.type)==="project"?"Project":"Conversation"]})}),(0,n.jsx)(eI,{value:z,onChange:e=>D(e.target.value),placeholder:"Enter new name",className:"my-4"}),(0,n.jsxs)(R,{children:[(0,n.jsx)(x,{type:"button",variant:"outline",onClick:()=>{E(!1),O(null),D("")},children:"Cancel"}),(0,n.jsx)(x,{type:"submit",variant:"default",children:"Save"})]})]})})})]})]})},e8=()=>{let[e,t]=(0,s.useState)(!1),[r,a]=(0,s.useState)("chat"),o=(0,s.useRef)(null);return s.useEffect(()=>{t(window.innerWidth>=768)},[]),(0,n.jsxs)("div",{className:"min-h-screen bg-background text-foreground flex relative overflow-x-hidden",children:[e&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 md:hidden z-40 backdrop-blur-sm transition-opacity duration-200",onClick:()=>t(!1)}),(0,n.jsx)(e6,{onExportConversation:(e,t)=>{console.log("Export",{projectId:e,conversationId:t})},isMobileMenuOpen:e,onMobileMenuToggle:()=>t(!e),onConversationSelect:()=>a("chat")}),(0,n.jsx)(x,{variant:"outline",size:"icon",className:"fixed left-4 top-4 z-50 md:hidden shadow-lg ".concat(e?"hidden":"flex"," w-9 h-9 rounded-full"),onClick:()=>t(!0),children:(0,n.jsx)(p.A,{className:"w-4 h-4"})}),(0,n.jsxs)("div",{className:"flex-1 relative",children:[(0,n.jsx)("div",{className:"absolute right-4 top-4 z-50 flex items-center gap-4 transition-opacity duration-200\n              ".concat(e?"opacity-100":"md:opacity-100 opacity-0 pointer-events-none md:pointer-events-auto"),children:(0,n.jsx)(c,{value:r,onValueChange:e=>{a(e),window.innerWidth<768&&t(!1),"chat"===e&&setTimeout(()=>{var e;null===(e=o.current)||void 0===e||e.focus()},0)},children:(0,n.jsx)("div",{className:"flex items-center gap-4 bg-background/80 backdrop-blur-sm rounded-lg shadow-lg p-1",children:(0,n.jsxs)(d,{className:"bg-transparent",children:[(0,n.jsx)(u,{value:"chat",children:"Chat"}),(0,n.jsx)(u,{value:"settings",children:"Settings"})]})})})}),(0,n.jsx)("div",{className:"flex flex-col h-full",children:(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("div",{className:"settings"===r?"hidden":"",children:(0,n.jsx)(c,{value:r,children:(0,n.jsx)(m,{value:"chat",forceMount:!0,children:(0,n.jsx)(eg,{ref:o})})})}),(0,n.jsx)("div",{className:"chat"===r?"hidden":"",children:(0,n.jsx)(c,{value:r,children:(0,n.jsx)(m,{value:"settings",forceMount:!0,children:(0,n.jsx)(e1,{})})})})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[158,477,441,517,358],()=>t(4352)),_N_E=e.O()}]);